{"version":3,"file":"wechat.js","sources":["utils/wechat.js"],"sourcesContent":["/**\n * 微信小程序API工具类（兼容Vue组件）\n * 封装常用的微信原生API，便于项目中统一调用\n */\n\n/**\n * 显示操作菜单\n * @param {Object} options - 配置项\n * @param {Array} options.itemList - 菜单选项列表\n * @param {Function} options.success - 成功回调\n * @param {Function} options.fail - 失败回调\n * @param {Function} options.complete - 完成回调\n */\nexport const showActionSheet = (options) => {\n  return new Promise((resolve, reject) => {\n    wx.showActionSheet({\n      itemList: options.itemList || [],\n      itemColor: options.itemColor || '#000000',\n      success: (res) => {\n        options.success && options.success(res)\n        resolve(res)\n      },\n      fail: (err) => {\n        options.fail && options.fail(err)\n        reject(err)\n      },\n      complete: options.complete\n    })\n  })\n}\n\n/**\n * 分享给微信好友\n * @param {Object} options - 分享配置\n * @param {String} options.title - 分享标题\n * @param {String} options.path - 分享路径\n * @param {String} options.imageUrl - 分享图片\n * @param {Function} options.success - 成功回调\n * @param {Function} options.fail - 失败回调\n */\nexport const shareAppMessage = (options) => {\n  return new Promise((resolve, reject) => {\n    // 直接调用分享API，无需setData（Vue组件中通过页面的onShareAppMessage返回配置）\n    wx.showShareMenu({\n      withShareTicket: true,\n      menus: ['shareAppMessage']\n    })\n    \n    // 在页面组件中需单独实现onShareAppMessage方法返回分享配置\n    resolve()\n  })\n}\n\n/**\n * 分享到朋友圈\n * @param {Object} options - 分享配置\n * @param {String} options.title - 分享标题\n * @param {String} options.query - 分享路径参数\n * @param {String} options.imageUrl - 分享图片\n * @param {Function} options.success - 成功回调\n * @param {Function} options.fail - 失败回调\n */\nexport const shareToTimeline = (options) => {\n  return new Promise((resolve, reject) => {\n    // 开启朋友圈分享权限\n    wx.updateShareMenu({\n      withShareTicket: true,\n      isTimelineShare: true,\n      success: () => {\n        // 调用朋友圈分享API\n        wx.shareTimeline({\n          title: options.title,\n          query: options.query || '',\n          imageUrl: options.imageUrl || '',\n          success: (res) => {\n            options.success && options.success(res)\n            resolve(res)\n          },\n          fail: (err) => {\n            options.fail && options.fail(err)\n            reject(err)\n          }\n        })\n      },\n      fail: (err) => {\n        options.fail && options.fail(err)\n        reject(err)\n      }\n    })\n  })\n}\n\n/**\n * 保存图片到相册\n * @param {Object} options - 配置项\n * @param {String} options.url - 图片地址\n * @param {Function} options.success - 成功回调\n * @param {Function} options.fail - 失败回调\n */\nexport const saveImageToPhotosAlbum = (options) => {\n  return new Promise((resolve, reject) => {\n    // 先下载图片\n    wx.downloadFile({\n      url: options.url,\n      success: (res) => {\n        if (res.statusCode === 200) {\n          // 保存图片到相册\n          wx.saveImageToPhotosAlbum({\n            filePath: res.tempFilePath,\n            success: (saveRes) => {\n              options.success && options.success(saveRes)\n              resolve(saveRes)\n            },\n            fail: (err) => {\n              // 如果是因为权限问题失败，引导用户开启权限\n              if (err.errMsg.indexOf('deny') > -1) {\n                wx.showModal({\n                  title: '提示',\n                  content: '需要获取相册权限才能保存图片，请在设置中开启',\n                  success: (modalRes) => {\n                    if (modalRes.confirm) {\n                      wx.openSetting()\n                    }\n                  }\n                })\n              }\n              options.fail && options.fail(err)\n              reject(err)\n            }\n          })\n        } else {\n          const error = new Error('图片下载失败')\n          options.fail && options.fail(error)\n          reject(error)\n        }\n      },\n      fail: (err) => {\n        options.fail && options.fail(err)\n        reject(err)\n      }\n    })\n  })\n}\n"],"names":["wx"],"mappings":";;AAaY,MAAC,kBAAkB,CAAC,YAAY;AAC1C,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCA,kBAAAA,KAAG,gBAAgB;AAAA,MACjB,UAAU,QAAQ,YAAY,CAAE;AAAA,MAChC,WAAW,QAAQ,aAAa;AAAA,MAChC,SAAS,CAAC,QAAQ;AAChB,gBAAQ,WAAW,QAAQ,QAAQ,GAAG;AACtC,gBAAQ,GAAG;AAAA,MACZ;AAAA,MACD,MAAM,CAAC,QAAQ;AACb,gBAAQ,QAAQ,QAAQ,KAAK,GAAG;AAChC,eAAO,GAAG;AAAA,MACX;AAAA,MACD,UAAU,QAAQ;AAAA,IACxB,CAAK;AAAA,EACL,CAAG;AACH;AAWY,MAAC,kBAAkB,CAAC,YAAY;AAC1C,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AAEtCA,kBAAAA,KAAG,cAAc;AAAA,MACf,iBAAiB;AAAA,MACjB,OAAO,CAAC,iBAAiB;AAAA,IAC/B,CAAK;AAGD,YAAS;AAAA,EACb,CAAG;AACH;;;"}