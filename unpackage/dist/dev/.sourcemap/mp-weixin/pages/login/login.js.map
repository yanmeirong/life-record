{"version":3,"file":"login.js","sources":["pages/login/login.vue","C:/Users/希希/Documents/HBuilderX.4.24.2024072208/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\n  <view class=\"login-page\">\n    <!-- 顶部Logo区域 -->\n    <view class=\"login-header\">\n      <view class=\"logo\">\n        <text class=\"logo-icon\">📝</text>\n      </view>\n      <view class=\"title\">生活记录</view>\n      <view class=\"subtitle\">记录美好生活的每一刻</view>\n    </view>\n\n    <!-- 登录表单 -->\n    <view class=\"login-form\">\n      <!-- 用户名输入 -->\n      <view class=\"form-item\">\n        <view class=\"input-wrapper\">\n          <text class=\"icon\">👤</text>\n          <input \n            v-model=\"username\"\n            type=\"text\"\n            placeholder=\"请输入用户名\"\n            @input=\"handleInput('username', $event)\"\n            :focus=\"focusField === 'username'\"\n            @focus=\"setFocus('username')\"\n            @blur=\"setFocus('')\"\n          />\n        </view>\n      </view>\n\n      <!-- 密码输入 -->\n      <view class=\"form-item\">\n        <view class=\"input-wrapper\">\n          <text class=\"icon\">🔒</text>\n          <input \n            v-model=\"password\"\n            :type=\"showPassword ? 'text' : 'password'\"\n            placeholder=\"请输入密码\"\n            @input=\"handleInput('password', $event)\"\n            :focus=\"focusField === 'password'\"\n            @focus=\"setFocus('password')\"\n            @blur=\"setFocus('')\"\n          />\n          <text \n            class=\"toggle-btn\" \n            @click=\"showPassword = !showPassword\"\n          >\n            {{ showPassword ? '隐藏' : '显示' }}\n          </text>\n        </view>\n      </view>\n\n      <!-- 错误提示 -->\n      <view v-if=\"errorMsg\" class=\"error-message\">\n        {{ errorMsg }}\n      </view>\n\n      <!-- 登录按钮 -->\n      <button \n        class=\"login-btn\"\n        :loading=\"loading\"\n        :disabled=\"!canLogin || loading\"\n        @click=\"handleLogin\"\n      >\n        登录\n      </button>\n\n      <!-- 其他登录方式 -->\n      <view class=\"other-login\">\n        <view class=\"line\"></view>\n        <view class=\"text\">其他登录方式</view>\n        <view class=\"line\"></view>\n      </view>\n\n      <view class=\"social-login\">\n        <button \n          class=\"social-btn\" \n          open-type=\"getUserInfo\" \n          @getuserinfo=\"handleWechatLogin\"\n        >\n          <text class=\"icon\">微信登录</text>\n        </button>\n      </view>\n    </view>\n\n    <!-- 底部信息 -->\n    <view class=\"footer\">\n      <view class=\"test-account\" v-if=\"showTestAccount\">\n        <text>测试账号: test / 123456</text>\n        <text class=\"close-btn\" @click=\"showTestAccount = false\">×</text>\n      </view>\n      <view class=\"copyright\">\n        © 2024 生活记录 版权所有\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, onUnmounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport request from '@/utils/request'\n\n// 注意：移除了从@dcloudio/uni-app的导入，直接使用全局uni对象\n\n// 响应式数据\nconst username = ref('')\nconst password = ref('')\nconst errorMsg = ref('')\nconst loading = ref(false)\nconst showPassword = ref(false)\nconst focusField = ref('')\nconst showTestAccount = ref(true)\nconst router = useRouter()\n\n// 计算属性 - 判断是否可以登录\nconst canLogin = computed(() => {\n  return username.value.trim().length > 0 && password.value.trim().length > 0\n})\n\n// 处理输入\nconst handleInput = (field, e) => {\n  if (field === 'username') {\n    username.value = e.detail.value.trim()\n  } else {\n    password.value = e.detail.value.trim()\n  }\n  // 输入时清除错误提示\n  if (errorMsg.value) {\n    errorMsg.value = ''\n  }\n}\n\n// 设置输入框焦点状态\nconst setFocus = (field) => {\n  focusField.value = field\n}\n\n// 检查是否已登录\nconst checkLoginStatus = () => {\n  // 直接使用uni.getStorageSync，无需导入\n  const token = uni.getStorageSync('token')\n  if (token) {\n    // 已登录，跳转到首页\n    uni.switchTab({ url: '/pages/life/life' })\n    return true\n  }\n  return false\n}\n\n// 账号密码登录\nconst handleLogin = async () => {\n  // 前端验证\n  if (!username.value.trim()) {\n    errorMsg.value = '请输入用户名'\n    return\n  }\n  if (!password.value.trim()) {\n    errorMsg.value = '请输入密码'\n    return\n  }\n\n  try {\n    loading.value = true\n    errorMsg.value = ''\n\n    // 调用登录接口\n    const res = await request.post('/api/v1/auth/login', {\n      username: username.value.trim(),\n      password: password.value.trim()\n    })\n\n    if (res.code === 200) {\n      // 登录成功，保存token和用户信息\n      uni.setStorageSync('token', res.data.token)\n      uni.setStorageSync('userInfo', res.data.user)\n\n      uni.showToast({\n        title: '登录成功',\n        icon: 'success',\n        duration: 1500\n      })\n\n      // 延迟跳转\n      setTimeout(() => {\n        const pages = getCurrentPages()\n        if (pages.length > 1) {\n          uni.navigateBack({ delta: 1 })\n        } else {\n          uni.switchTab({ url: '/pages/life/life' })\n        }\n      }, 1500)\n    } else {\n      errorMsg.value = res.message || '登录失败，请重试'\n    }\n  } catch (err) {\n    errorMsg.value = err.message || '网络异常，请检查网络连接'\n  } finally {\n    loading.value = false\n  }\n}\n\n// 微信快捷登录\nconst handleWechatLogin = async (e) => {\n  try {\n    loading.value = true\n    errorMsg.value = ''\n\n    // 获取用户信息\n    const userInfo = e.detail.userInfo\n    if (!userInfo) {\n      errorMsg.value = '请授权用户信息'\n      return\n    }\n\n    // 调用微信登录接口获取code\n    const loginRes = await new Promise((resolve, reject) => {\n      uni.login({\n        provider: 'weixin',\n        success: resolve,\n        fail: reject\n      })\n    })\n\n    // 调用后端微信登录接口\n    const res = await request.post('/api/v1/auth/wechat-login', {\n      code: loginRes.code,\n      userInfo: userInfo\n    })\n\n    if (res.code === 200) {\n      // 登录成功处理，同上\n      uni.setStorageSync('token', res.data.token)\n      uni.setStorageSync('userInfo', res.data.user)\n\n      uni.showToast({\n        title: '登录成功',\n        icon: 'success',\n        duration: 1500\n      })\n\n      setTimeout(() => {\n        const pages = getCurrentPages()\n        if (pages.length > 1) {\n          uni.navigateBack({ delta: 1 })\n        } else {\n          uni.switchTab({ url: '/pages/life/life' })\n        }\n      }, 1500)\n    } else {\n      errorMsg.value = res.message || '微信登录失败'\n    }\n  } catch (err) {\n    errorMsg.value = err.message || '微信登录异常'\n  } finally {\n    loading.value = false\n  }\n}\n\n// 页面挂载时检查登录状态\nonMounted(() => {\n  // 延迟检查，避免页面切换过快\n  const timer = setTimeout(() => {\n    checkLoginStatus()\n  }, 500)\n  \n  onUnmounted(() => {\n    clearTimeout(timer)\n  })\n})\n</script>\n\n<style scoped lang=\"scss\">\n/* 样式部分保持不变 */\n.login-page {\n  display: flex;\n  flex-direction: column;\n  min-height: 100vh;\n  background-color: #f7f8fa;\n  padding: 0 30rpx;\n}\n\n// 头部样式\n.login-header {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 80rpx 0 60rpx;\n\n  .logo {\n    width: 140rpx;\n    height: 140rpx;\n    border-radius: 50%;\n    background-color: #07c160;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    margin-bottom: 30rpx;\n\n    .logo-icon {\n      font-size: 70rpx;\n    }\n  }\n\n  .title {\n    font-size: 48rpx;\n    font-weight: bold;\n    color: #333;\n    margin-bottom: 15rpx;\n  }\n\n  .subtitle {\n    font-size: 28rpx;\n    color: #666;\n  }\n}\n\n// 表单样式\n.login-form {\n  flex: 1;\n  width: 100%;\n  max-width: 500rpx;\n  margin: 0 auto;\n\n  .form-item {\n    margin-bottom: 30rpx;\n\n    .input-wrapper {\n      display: flex;\n      align-items: center;\n      background-color: #fff;\n      border-radius: 80rpx;\n      padding: 0 30rpx;\n      height: 90rpx;\n      box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\n\n      .icon {\n        font-size: 36rpx;\n        color: #666;\n        margin-right: 20rpx;\n        width: 40rpx;\n        text-align: center;\n      }\n\n      input {\n        flex: 1;\n        height: 100%;\n        font-size: 32rpx;\n        color: #333;\n      }\n\n      .toggle-btn {\n        font-size: 28rpx;\n        color: #07c160;\n        padding-left: 20rpx;\n      }\n    }\n  }\n\n  .error-message {\n    font-size: 26rpx;\n    color: #ff4d4f;\n    padding: 10rpx 30rpx;\n    min-height: 36rpx;\n  }\n\n  .login-btn {\n    width: 100%;\n    height: 90rpx;\n    line-height: 90rpx;\n    background-color: #07c160;\n    color: #fff;\n    font-size: 34rpx;\n    border-radius: 45rpx;\n    margin: 40rpx 0;\n    box-shadow: 0 5rpx 15rpx rgba(7, 193, 96, 0.3);\n\n    &:disabled {\n      background-color: #a5e8c5;\n      box-shadow: none;\n    }\n  }\n\n  .other-login {\n    display: flex;\n    align-items: center;\n    margin: 60rpx 0 40rpx;\n\n    .line {\n      flex: 1;\n      height: 1rpx;\n      background-color: #eee;\n    }\n\n    .text {\n      padding: 0 20rpx;\n      font-size: 26rpx;\n      color: #999;\n    }\n  }\n\n  .social-login {\n    display: flex;\n    justify-content: center;\n\n    .social-btn {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: 180rpx;\n      height: 60rpx;\n      background-color: #07c160;\n      color: #fff;\n      font-size: 28rpx;\n      border-radius: 30rpx;\n    }\n  }\n}\n\n// 底部样式\n.footer {\n  padding: 40rpx 0;\n  text-align: center;\n\n  .test-account {\n    display: inline-flex;\n    align-items: center;\n    background-color: #fff8e6;\n    color: #ff9800;\n    font-size: 24rpx;\n    padding: 8rpx 20rpx;\n    border-radius: 20rpx;\n    margin-bottom: 20rpx;\n\n    .close-btn {\n      margin-left: 10rpx;\n      font-size: 28rpx;\n      font-weight: bold;\n    }\n  }\n\n  .copyright {\n    font-size: 22rpx;\n    color: #999;\n  }\n}\n\n// 适配深色模式\n@media (prefers-color-scheme: dark) {\n  .login-page {\n    background-color: #1a1a1a;\n  }\n\n  .login-header {\n    .title {\n      color: #fff;\n    }\n    .subtitle {\n      color: #ccc;\n    }\n  }\n\n  .input-wrapper {\n    background-color: #333;\n\n    input {\n      color: #fff;\n    }\n  }\n\n  .copyright {\n    color: #666;\n  }\n}\n</style>\n    ","import MiniProgramPage from 'D:/uniapp/my-lifeRecord/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","useRouter","computed","uni","request","onMounted","onUnmounted"],"mappings":"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"}